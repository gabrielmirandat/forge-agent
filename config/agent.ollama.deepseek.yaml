agent:
  name: forge-agent
  version: 0.1.0
  
  workspace:
    base_path: ~/repos
    persistent: true
    cleanup_on_exit: false
  
  llm:
    provider: ollama
    base_url: http://localhost:11434
    # DeepSeek R1 8b model - Reasoning model with tool calling support
    # âœ… Supports tool calling according to Ollama docs
    # Note: Model name may vary - check available models with: ollama list
    # Available names: deepseek-r1:8b, deepseek-r1-8b
    # To download: ollama pull deepseek-r1:8b
    model: deepseek-r1:8b
    # Temperature: 0.0 for deterministic JSON output (recommended for tool calling)
    temperature: 0.0
    max_tokens: 4096
    timeout: 300
  
  runtime:
    max_iterations: 50
    timeout_seconds: 3600
    enable_parallel_tools: true
    safety_checks: true
    auto_execution: true
    continuous_loop: true
  
  logging:
    level: INFO
    format: json
    output_path: ./workspace/logs
  
  human_in_the_loop:
    enabled: false
  
  # System prompt template with placeholders:
  # - {workspace_base}: Workspace base path
  # - {tools}: MCP servers with tools (format: "server_name - whenever you need X - description - Available functions: ...")
  # IMPORTANT: Clear system instructions help the model format tool calls correctly
  # Temperature=0.0 ensures deterministic JSON output for tool calls
  system_prompt_template: |
    You are a code agent that should help the user manage their repositories.
    All repositories are in the system at {workspace_base}.
    
    You have access to various tools for filesystem operations, git operations, and other tasks.
    Use the tools when you need to perform actual operations. For simple conversational questions, respond directly without using tools.
    
    When using tools:
    - Use natural repository names (e.g., "forge-agent") - the system will automatically resolve paths
    - Be specific about what you want to do
    - Use tool chaining when needed to accomplish complex tasks
    
    Available tools:
    {tools}
  
  mcp:
    # MCP servers via Docker
    # Docker containers are automatically managed on application startup
    # Images are pulled if not available, containers are started/stopped as needed
    # Each connection creates an ephemeral container using docker run -i --rm
    
    # Filesystem MCP server - official Docker MCP server for filesystem operations
    # See: https://hub.docker.com/mcp/server/filesystem/overview
    # See: https://github.com/modelcontextprotocol/servers/tree/main/src/filesystem
    # Version 1.0.2+ requires the directory path as argument to set allowed directories
    # The server automatically restricts access to only the specified directory for security
    # Provides: list_directory, read_file, write_file, create_directory, move_file, search_files, etc.
    filesystem:
      type: docker
      enabled: true
      # Use specific version for stability (1.0.2)
      # The :latest tag may point to newer versions with breaking changes
      image: "mcp/filesystem:1.0.2"
      volumes:
        - "{{workspace.base_path}}:/projects"
      # The directory path argument sets the allowed directory for security
      # This is required by the filesystem server v1.0.2+
      # The server will only allow access to this directory and its subdirectories
      args: ["/projects"]
      timeout: 5000
    
    # Playwright MCP server - browser automation (navigate, click, screenshot, etc.)
    # See: https://hub.docker.com/r/mcp/playwright
    # No token required - runs browser automation locally
    playwright:
      type: docker
      enabled: true
      image: "mcp/playwright:latest"
      volumes:
        - "{{workspace.base_path}}:/workspace"
      args: []
      timeout: 5000
    
    # OpenAPI MCP server - interact with OpenAPI/Swagger APIs
    # See: https://hub.docker.com/r/mcp/openapi
    openapi:
      type: docker
      enabled: true
      image: "mcp/openapi:latest"
      volumes:
        - "{{workspace.base_path}}:/workspace"
      args: []
      timeout: 5000
    
    # Python Refactoring MCP server - code refactoring and analysis
    # See: https://hub.docker.com/r/mcp/mcp-python-refactoring
    python_refactoring:
      type: docker
      enabled: true
      image: "mcp/mcp-python-refactoring:latest"
      volumes:
        - "{{workspace.base_path}}:/workspace"
      args: []
      timeout: 5000
    
    # Git MCP server - Git operations (clone, commit, push, etc.)
    # See: https://hub.docker.com/r/mcp/git
    # Optional: GITHUB_TOKEN env var for private repos (set in .env file)
    git:
      type: docker
      enabled: true
      image: "mcp/git:latest"
      volumes:
        - "{{workspace.base_path}}:/workspace"
      args: []
      timeout: 5000
      environment:
        # GITHUB_TOKEN will be read from system environment if set
        GITHUB_TOKEN: "{{env:GITHUB_TOKEN}}"
        # Configure Git to trust all repositories in /workspace
        # This prevents "dubious ownership" errors when accessing repos from Docker container
        GIT_CONFIG_COUNT: "1"
        GIT_CONFIG_KEY_0: "safe.directory"
        GIT_CONFIG_VALUE_0: "*"
      # Note: Set GITHUB_TOKEN in .env file if needed for private repos
    
    # GitHub MCP server - GitHub API operations (issues, PRs, code search)
    # See: https://hub.docker.com/r/mcp/github
    # REQUIRES: GITHUB_PERSONAL_ACCESS_TOKEN env var (set in .env file)
    github:
      type: docker
      enabled: false  # Disabled by default - requires GITHUB_PERSONAL_ACCESS_TOKEN
      image: "mcp/github:latest"
      volumes:
        - "{{workspace.base_path}}:/workspace"
      args: []
      timeout: 5000
      environment:
        # GITHUB_PERSONAL_ACCESS_TOKEN will be read from system environment
        GITHUB_PERSONAL_ACCESS_TOKEN: "{{env:GITHUB_PERSONAL_ACCESS_TOKEN}}"
      # Note: Set GITHUB_PERSONAL_ACCESS_TOKEN in .env file to enable
    
    # Fetch MCP server - fetch URLs and convert to Markdown
    # See: https://hub.docker.com/r/mcp/fetch
    # No token required - simple web content extraction
    fetch:
      type: docker
      enabled: true
      image: "mcp/fetch:latest"
      volumes:
        - "{{workspace.base_path}}:/workspace"
      args: []
      timeout: 5000
